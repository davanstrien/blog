<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel van Strien">
<meta name="dcterms.date" content="2022-08-16">
<meta name="description" content="Training a Detr object detection model using Hugging Face transformers and datasets">

<title>Training an object detection model using Hugging Face – Daniel van Strien</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../icons/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-F61N6B5LBY"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-F61N6B5LBY', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Daniel van Strien</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/davanstrien"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/vanstriendaniel"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Training an object detection model using Hugging Face</h1>
</div>

<div>
  <div class="description">
    Training a Detr object detection model using Hugging Face transformers and datasets
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel van Strien </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 16, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="training-a-detr-object-detection-model-using-hugging-face-transformers-and-datasets" class="level2">
<h2 class="anchored" data-anchor-id="training-a-detr-object-detection-model-using-hugging-face-transformers-and-datasets">Training a Detr object detection model using Hugging Face transformers and datasets</h2>
<p>The Hugging Face <a href="https://huggingface.co/docs/transformers/index">transformers</a> library has increasingly expanded from its original focus on Natural Language Processing tasks to include more models covering a range of computer vision tasks. This blog post will look at how we can train an object detection model using the Hugging Face transformers and datasets libraries.</p>
</section>
<section id="what-is-object-detection" class="level2">
<h2 class="anchored" data-anchor-id="what-is-object-detection">What is object detection?</h2>
<p>Object detection is the task of predicting objects contained within an image.</p>
<p><img src="https://blog.jetbrains.com/wp-content/uploads/2022/01/dog.jpg" class="img-fluid"></p>
<p>Object detection can be helpful in several applications where you want to know not only whether a thing is in an image but where (and how many) of that thing there are. Various approaches have been developed over the years for this task, often relying on various complex hand-crafted features.</p>
<p>As with other areas of computer vision, there has been an increasing adoption of transformer-based solutions to this task. One model using transformers is the Detr architecture.</p>
</section>
<section id="what-is-detr" class="level2">
<h2 class="anchored" data-anchor-id="what-is-detr">What is Detr?</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="detr_diagram.webp" class="img-fluid figure-img"></p>
<figcaption>Diagram of the DETR architecture</figcaption>
</figure>
</div>
<p>Detr (DEtection TRansformer) is a model architecture introduced in the paper <a href="https://arxiv.org/abs/2005.12872">End-to-End Object Detection with Transformers</a>. We won’t dig into the architecture in massive detail in this blog since we’re focused on the practical use of this model architecture in this post. One thing that is important to note here is that <code>DETR</code> still uses a CNN backbone. More recently, other models such as <a href="https://arxiv.org/abs/2106.00666">YOLOS</a> use a transformer backbone too. Currently, however, these fully transformer-based approaches show some performance gap over more traditional techniques (because this is deep learning, ‘traditional’ refers to stuff from last year, of course).</p>
</section>
<section id="using-hugging-face-for-object-detection" class="level2">
<h2 class="anchored" data-anchor-id="using-hugging-face-for-object-detection">Using Hugging Face for object detection</h2>
<p>There are existing examples for using the Hugging Face transformers library and datasets with the <a href="https://huggingface.co/docs/transformers/main_classes/trainer">Trainer</a> class to do <a href="https://huggingface.co/blog/fine-tune-vit">image classification</a>. There are also <a href="https://github.com/NielsRogge/Transformers-Tutorials/tree/master/DETR">example notebooks</a> showing how to fine-tune a Detr model on custom data. However, I didn’t find examples that use the datasets library and the <a href="https://huggingface.co/docs/transformers/main_classes/trainer">Trainer</a> class to manage training. Training an object detection model using datasets and the transformers library is what this blog post covers.</p>
<section id="why-the-datasets-library" class="level3">
<h3 class="anchored" data-anchor-id="why-the-datasets-library">Why the datasets library?</h3>
<p>You may ask why it is helpful to provide an example of using the datasets library for training an object detection model, i.e.&nbsp;why not use PyTorch for the data loading, which already has many examples for training object detection models?</p>
<p>There are a few reasons why trying to use datasets for this can be helpful. A significant one for me is the close integration between the datasets library and the Hugging Face datasets hub. Loading a dataset from the hugging face hub often involves two lines of code (including the imports).</p>
<p>Quickly loading a dataset and then using the same library to prepare the dataset for training an object detection model removes some friction. This becomes especially helpful when you are iterating on the process of creating training data, training a model, and creating more training data. In this iterative process, the hub can be used for storing models and datasets at each stage. Having a clear provenance of these changes (without relying on additional tools) is also a benefit of this workflow. This is the kind of pipeline <a href="https://github.com/davanstrien/hugit-cli/">hugit</a> is intended to support (in this case, for image classification models).</p>
</section>
<section id="scope-of-this-blog-post" class="level3">
<h3 class="anchored" data-anchor-id="scope-of-this-blog-post">Scope of this blog post</h3>
<p>At the moment, this is mainly intended to give a quick overview of the steps involved. It isn’t intended to be a proper tutorial. If I have time later, I may flesh this out (particularly if other projects I’m working on that use object detection progress further).</p>
<p>Enough talk, let’s get started. First we install required libraries.</p>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install datasets transformers timm wandb rich[jupyter]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’m a big fan of the <a href="https://rich.readthedocs.io/en/stable/">rich library</a> so almost always have this extension loaded.</p>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext rich</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next couple of lines gets us authenticated with the Hugging Face hub.</p>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>git config <span class="op">--</span><span class="kw">global</span> credential.helper store</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> huggingface_hub <span class="im">import</span> notebook_login</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>notebook_login()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Login successful
Your token has been saved to /root/.huggingface/token</code></pre>
</div>
</div>
<p>We’ll use <a href="https://wandb.ai/site">Weights and Biases</a> for tracking our model training.</p>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wandb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>wandb.login()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>env WANDB_PROJECT<span class="op">=</span>chapbooks</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>env WANDB_ENTITY<span class="op">=</span>davanstrien</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="loading-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-dataset">Loading the dataset</h2>
<p>In this blog post will use a dataset being added to the Hugging Face datasets hub as part of the <a href="https://github.com/bigscience-workshop/lam">BigLAM</a> hackathon. This dataset has a configuration for object detection and image classification, so we’ll need to specify which one we want. Since the dataset doesn’t define train/test/valid splits for us, we’ll grab the training split. I won’t provide a full description of the dataset in this blog post since the dataset is still in the process of being documented. The tl;dr summary is that the dataset includes images of digitized books with bounding boxes for illustrations.</p>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasets <span class="im">import</span> load_dataset</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> load_dataset(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"biglam/nls_chapbook_illustrations"</span>, <span class="st">"illustration-detection"</span>, split<span class="op">=</span><span class="st">"train"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Reusing dataset nls_chapbook_illustrations (/Users/dvanstrien/.cache/huggingface/datasets/biglam___nls_chapbook_illustrations/illustration-detection/1.0.0/75f355eb0ba564ef120939a78730eb187a4d3eb682e987ed1f682a5bea5466eb)</code></pre>
</div>
</div>
<p>Let’s take a look at one example from this dataset to get a sense of how the data looks</p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dataset[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'image_id'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span>,
    <span style="color: #008000; text-decoration-color: #008000">'image'</span>: <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">PIL.JpegImagePlugin.JpegImageFile</span><span style="color: #000000; text-decoration-color: #000000"> image </span><span style="color: #808000; text-decoration-color: #808000">mode</span><span style="color: #000000; text-decoration-color: #000000">=</span><span style="color: #800080; text-decoration-color: #800080">RGB</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #808000; text-decoration-color: #808000">size</span><span style="color: #000000; text-decoration-color: #000000">=</span><span style="color: #800080; text-decoration-color: #800080">60</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0x1080</span><span style="color: #000000; text-decoration-color: #000000"> at </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0x7FDD6504FAD0</span><span style="font-weight: bold">&gt;</span>,
    <span style="color: #008000; text-decoration-color: #008000">'width'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">600</span>,
    <span style="color: #008000; text-decoration-color: #008000">'height'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1080</span>,
    <span style="color: #008000; text-decoration-color: #008000">'url'</span>: <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>,
    <span style="color: #008000; text-decoration-color: #008000">'date_captured'</span>: <span style="color: #008000; text-decoration-color: #008000">''</span>,
    <span style="color: #008000; text-decoration-color: #008000">'objects'</span>: <span style="font-weight: bold">[</span>
        <span style="font-weight: bold">{</span>
            <span style="color: #008000; text-decoration-color: #008000">'category_id'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>,
            <span style="color: #008000; text-decoration-color: #008000">'image_id'</span>: <span style="color: #008000; text-decoration-color: #008000">'4'</span>,
            <span style="color: #008000; text-decoration-color: #008000">'id'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,
            <span style="color: #008000; text-decoration-color: #008000">'area'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">110901</span>,
            <span style="color: #008000; text-decoration-color: #008000">'bbox'</span>: <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.529998779296875</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">556.8300170898438</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">401.44000244140625</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">276.260009765625</span><span style="font-weight: bold">]</span>,
            <span style="color: #008000; text-decoration-color: #008000">'segmentation'</span>: <span style="font-weight: bold">[</span>
                <span style="font-weight: bold">[</span>
                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.529998779296875</span>,
                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">556.8300170898438</span>,
                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">435.9700012207031</span>,
                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">556.8300170898438</span>,
                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">435.9700012207031</span>,
                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">833.0900268554688</span>,
                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">34.529998779296875</span>,
                    <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">833.0900268554688</span>
                <span style="font-weight: bold">]</span>
            <span style="font-weight: bold">]</span>,
            <span style="color: #008000; text-decoration-color: #008000">'iscrowd'</span>: <span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>
        <span style="font-weight: bold">}</span>
    <span style="font-weight: bold">]</span>
<span style="font-weight: bold">}</span>
</pre>
</div>
</div>
<p>You will see we hav some metadata for the image, the image itself and the field <code>objects</code> contains the annotations themselves. Looking just at an example of the annotations:</p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hide_output</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"category_id"</span>: <span class="dv">0</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"image_id"</span>: <span class="st">"4"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span>: <span class="dv">1</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"area"</span>: <span class="dv">110901</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bbox"</span>: [</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="fl">34.529998779296875</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="fl">556.8300170898438</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="fl">401.44000244140625</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="fl">276.260009765625</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"segmentation"</span>: [</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>            <span class="fl">34.529998779296875</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>            <span class="fl">556.8300170898438</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            <span class="fl">435.9700012207031</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>            <span class="fl">556.8300170898438</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            <span class="fl">435.9700012207031</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>            <span class="fl">833.0900268554688</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            <span class="fl">34.529998779296875</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            <span class="fl">833.0900268554688</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"iscrowd"</span>: <span class="va">False</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'category_id': 0,
 'image_id': '4',
 'id': 1,
 'area': 110901,
 'bbox': [34.529998779296875,
  556.8300170898438,
  401.44000244140625,
  276.260009765625],
 'segmentation': [[34.529998779296875,
   556.8300170898438,
   435.9700012207031,
   556.8300170898438,
   435.9700012207031,
   833.0900268554688,
   34.529998779296875,
   833.0900268554688]],
 'iscrowd': False}</code></pre>
</div>
</div>
<p>We see here, that we again have some metadata for each image. We also have a <code>category_id</code> and a <code>bbox</code>. Some of these fields should look familiar to you if you are familiar with the <a href="https://cocodataset.org/">coco</a> format. This will become relevant later, so don’t worry if these aren’t familiar to you.</p>
<p>One issue we can run into when training object detection models is stray bounding boxes (i.e.&nbsp;ones where the bounding boxes stretch beyond the edge of the image). We can check and remove these quite easily. This is some ugly code/there is probably a better way, but this is a quick check, so I’ll forgive myself.</p>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>remove_idx <span class="op">=</span> []</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> tqdm(<span class="bu">enumerate</span>(dataset)):</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    objects_ <span class="op">=</span> row[<span class="st">"objects"</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ob <span class="kw">in</span> objects_:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        bbox <span class="op">=</span> ob[<span class="st">"bbox"</span>]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        negative <span class="op">=</span> [box <span class="cf">for</span> box <span class="kw">in</span> bbox <span class="cf">if</span> box <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> negative:</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            remove_idx.append(idx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a3c0d2386f334d238441126da158585e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(remove_idx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>
</pre>
</div>
</div>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>keep <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dataset)) <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> remove_idx]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(keep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7257</span>
</pre>
</div>
</div>
<p>The above code has given us a list of indexes to keep so we use the <code>select</code> method to grab those.</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> dataset.select(keep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also create a test split. If we were properly doing this we’d likely want to be a bit more thoughfull about how to do this split.</p>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> dataset.train_test_split(<span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data">Preparing the data</h2>
<p>This section of the blog post is the bit which focuses on getting data ready for an object detection model such as detr via the datasets library. This is, therefore, also the section which will differ most from the other examples showing how to train models using PyTorch data loaders.</p>
<section id="the-feature-extractor" class="level3">
<h3 class="anchored" data-anchor-id="the-feature-extractor">The Feature Extractor</h3>
<p>If you are familiar with Hugging Face for natural language tasks, you are probably familiar with using <code>Tokenizer_for_blah_model</code> when pre-processing text. Often if you are using a pre-trained model, you will use <code>AutoTokenizer.from_pretrained</code>, passing in the ID to the model you want to fine-tune. This tokenizer then ensures that the tokenization matches the approach used for the pre-trained model.</p>
<p>The Feature Extractor performs a similar task. Let’s look at this more closely. We’ll use a pre-trained model for this example and fine-tune it. I also include commented-out code, which shows how you could use the same process with any CNN backbone. This may be useful if you have particular requirements about what backbone to use or if you have a CNN backbone that is already fine-tuned on your domain.</p>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>model_checkpoint <span class="op">=</span> <span class="st">"facebook/detr-resnet-50"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> DetrFeatureExtractor</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>feature_extractor <span class="op">=</span> DetrFeatureExtractor.from_pretrained(model_checkpoint)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9722fcf5be06468d958a5aaef044a458","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<p>If you wanted to use a different CNN backbone as your starting point you would instead define a config.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from transformers import DetrConfig</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from transformers import DetrFeatureExtractor</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># feature_extractor = DetrFeatureExtractor()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="what-does-the-feature-extractor-do" class="level4">
<h4 class="anchored" data-anchor-id="what-does-the-feature-extractor-do">What does the feature extractor do?</h4>
<p>To check what feature extractor does we can make use of the handy <code>inspect</code> function</p>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rich <span class="im">import</span> inspect</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collapse_show</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>inspect(feature_extractor, methods<span class="op">=</span><span class="va">True</span>, dunder<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #000080; text-decoration-color: #000080">╭─ DetrFeatureExtractor </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">{</span><span style="color: #000080; text-decoration-color: #000080">   </span><span style="color: #008000; text-decoration-color: #008000">"do_normalize"</span><span style="color: #000080; text-decoration-color: #000080">: true,   </span><span style="color: #008000; text-decoration-color: #008000">"do_resize"</span><span style="color: #000080; text-decoration-color: #000080">: true,   </span><span style="color: #008000; text-decoration-color: #008000">"feature_extractor_type"</span><span style="color: #000080; text-decoration-color: #000080">: </span><span style="color: #008000; text-decoration-color: #008000">"DetrFeatureEx</span><span style="color: #000080; text-decoration-color: #000080">─╮</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="font-weight: bold">(</span>images: Union<span style="font-weight: bold">[</span>PIL.Image.Image, numpy.ndarray, <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'torch.Tensor'</span><span style="font-weight: bold">)</span>, List<span style="font-weight: bold">[</span>PIL.Image.Image<span style="font-weight: bold">]</span>,           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> List<span style="font-weight: bold">[</span>numpy.ndarray<span style="font-weight: bold">]</span>, List<span style="font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'torch.Tensor'</span><span style="font-weight: bold">)]]</span>, annotations: Union<span style="font-weight: bold">[</span>List<span style="font-weight: bold">[</span>Dict<span style="font-weight: bold">]</span>, List<span style="font-weight: bold">[</span>List<span style="font-weight: bold">[</span>Dict<span style="font-weight: bold">]]]</span> =      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, return_segmentation_masks: Union<span style="font-weight: bold">[</span>bool, NoneType<span style="font-weight: bold">]</span> = <span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>, masks_path: Union<span style="font-weight: bold">[</span>pathlib.Path, NoneType<span style="font-weight: bold">]</span> =     <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, pad_and_return_pixel_mask: Union<span style="font-weight: bold">[</span>bool, NoneType<span style="font-weight: bold">]</span> = <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>, return_tensors: Union<span style="font-weight: bold">[</span>str,                       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> transformers.utils.generic.TensorType, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, **kwargs<span style="font-weight: bold">)</span> -&gt;                                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> transformers.feature_extraction_utils.BatchFeature:                                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                                                                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008080; text-decoration-color: #008080">Constructs a DETR feature extractor.</span>                                                                            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                                                                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_auto_class</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>                                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                   <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__dict__</span> = <span style="font-weight: bold">{</span>                                                                                  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'_processor_class'</span>: <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>,                                                      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'feature_extractor_type'</span>: <span style="color: #008000; text-decoration-color: #008000">'DetrFeatureExtractor'</span>,                              <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'format'</span>: <span style="color: #008000; text-decoration-color: #008000">'coco_detection'</span>,                                                    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'do_resize'</span>: <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>,                                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'size'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span>,                                                                   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'max_size'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1333</span>,                                                              <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'do_normalize'</span>: <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>,                                                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'image_mean'</span>: <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.485</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.456</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.406</span><span style="font-weight: bold">]</span>,                                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                  <span style="color: #008000; text-decoration-color: #008000">'image_std'</span>: <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.229</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.224</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.225</span><span style="font-weight: bold">]</span>                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="font-weight: bold">}</span>                                                                                  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>               <span style="color: #808000; text-decoration-color: #808000; font-style: italic">do_normalize</span> = <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>                                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">do_resize</span> = <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>                                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                    <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__doc__</span> = <span style="color: #008000; text-decoration-color: #008000">'\n    Constructs a DETR feature extractor.\n\n    This feature extractor inherits</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">from [`FeatureExtractionMixin`] which contains most of the main methods. Users\n  </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">should refer to this superclass for more information regarding those </span>              <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">methods.\n\n\n    Args:\n        format (`str`, *optional*, defaults to </span>           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">`"coco_detection"`):\n            Data format of the annotations. One of </span>          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">"coco_detection" or "coco_panoptic".\n        do_resize (`bool`, *optional*, </span>      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">defaults to `True`):\n            Whether to resize the input to a certain </span>        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">`size`.\n        size (`int`, *optional*, defaults to 800):\n            Resize </span>   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">the input to the given size. Only has an effect if `do_resize` is set to `True`. </span>  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">If size is a\n            sequence like `(width, height)`, output size will be </span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">matched to this. If size is an int, smaller edge of\n            the image will be</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">matched to this number. i.e, if `height &gt; width`, then image will be rescaled to </span>  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">`(size *\n            height / width, size)`.\n        max_size (`int`, </span>           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">*optional*, defaults to `1333`):\n            The largest size an image dimension </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">can have (otherwise it\'s capped). Only has an effect if `do_resize` is\n         </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">set to `True`.\n        do_normalize (`bool`, *optional*, defaults to `True`):\n  </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">Whether or not to normalize the input with mean and standard deviation.\n        </span>  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">image_mean (`int`, *optional*, defaults to `[0.485, 0.456, 0.406]`):\n            </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">The sequence of means for each channel, to be used when normalizing images. </span>       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">Defaults to the ImageNet mean.\n        image_std (`int`, *optional*, defaults to </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">`[0.229, 0.224, 0.225]`):\n            The sequence of standard deviations for </span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">each channel, to be used when normalizing images. Defaults to the\n            </span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #008000; text-decoration-color: #008000">ImageNet std.\n    '</span>                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>     <span style="color: #808000; text-decoration-color: #808000; font-style: italic">feature_extractor_type</span> = <span style="color: #008000; text-decoration-color: #008000">'DetrFeatureExtractor'</span>                                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                     <span style="color: #808000; text-decoration-color: #808000; font-style: italic">format</span> = <span style="color: #008000; text-decoration-color: #008000">'coco_detection'</span>                                                                   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                 <span style="color: #808000; text-decoration-color: #808000; font-style: italic">image_mean</span> = <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.485</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.456</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.406</span><span style="font-weight: bold">]</span>                                                              <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">image_std</span> = <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.229</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.224</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.225</span><span style="font-weight: bold">]</span>                                                              <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                   <span style="color: #808000; text-decoration-color: #808000; font-style: italic">max_size</span> = <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1333</span>                                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>          <span style="color: #808000; text-decoration-color: #808000; font-style: italic">model_input_names</span> = <span style="font-weight: bold">[</span><span style="color: #008000; text-decoration-color: #008000">'pixel_values'</span>, <span style="color: #008000; text-decoration-color: #008000">'pixel_mask'</span><span style="font-weight: bold">]</span>                                                     <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                 <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__module__</span> = <span style="color: #008000; text-decoration-color: #008000">'transformers.models.detr.feature_extraction_detr'</span>                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>           <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_processor_class</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>                                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                       <span style="color: #808000; text-decoration-color: #808000; font-style: italic">size</span> = <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span>                                                                                <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__weakref__</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>                                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                   <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__call__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__call__</span><span style="font-weight: bold">(</span>images: Union<span style="font-weight: bold">[</span>PIL.Image.Image, numpy.ndarray,                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'torch.Tensor'</span><span style="font-weight: bold">)</span>, List<span style="font-weight: bold">[</span>PIL.Image.Image<span style="font-weight: bold">]</span>, List<span style="font-weight: bold">[</span>numpy.ndarray<span style="font-weight: bold">]</span>,            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              List<span style="font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'torch.Tensor'</span><span style="font-weight: bold">)]]</span>, annotations: Union<span style="font-weight: bold">[</span>List<span style="font-weight: bold">[</span>Dict<span style="font-weight: bold">]</span>,                  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              List<span style="font-weight: bold">[</span>List<span style="font-weight: bold">[</span>Dict<span style="font-weight: bold">]]]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, return_segmentation_masks: Union<span style="font-weight: bold">[</span>bool, NoneType<span style="font-weight: bold">]</span> =       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>, masks_path: Union<span style="font-weight: bold">[</span>pathlib.Path, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>,                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              pad_and_return_pixel_mask: Union<span style="font-weight: bold">[</span>bool, NoneType<span style="font-weight: bold">]</span> = <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>, return_tensors:           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              Union<span style="font-weight: bold">[</span>str, transformers.utils.generic.TensorType, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, **kwargs<span style="font-weight: bold">)</span> -&gt;   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              transformers.feature_extraction_utils.BatchFeature:                                <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Main method to prepare for the model one or several </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">image</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">s</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> and optional </span>         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">annotations. Images are by default</span>                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">padded up to the largest image in a batch, and a pixel mask is created that </span>       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">indicates which pixels are</span>                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">real/which are padding.</span>                                                            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                <span style="color: #808000; text-decoration-color: #808000; font-style: italic">center_crop</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">center_crop</span><span style="font-weight: bold">(</span>image, size<span style="font-weight: bold">)</span>:                                                      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Crops `image` to the given size using a center crop. Note that if the image is too</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">small to be cropped to the</span>                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">size given, it will be padded </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">so the returned result has the size asked</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                  <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__class__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">class </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__class__</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">format</span>=<span style="color: #008000; text-decoration-color: #008000">'coco_detection'</span>, <span style="color: #808000; text-decoration-color: #808000">do_resize</span>=<span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>, <span style="color: #808000; text-decoration-color: #808000">size</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span>, <span style="color: #808000; text-decoration-color: #808000">max_size</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1333</span>,  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #808000; text-decoration-color: #808000">do_normalize</span>=<span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>, <span style="color: #808000; text-decoration-color: #808000">image_mean</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, <span style="color: #808000; text-decoration-color: #808000">image_std</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, **kwargs<span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Constructs a DETR </span>  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">feature extractor.</span>                                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">convert_coco_poly_to_mask</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">convert_coco_poly_to_mask</span><span style="font-weight: bold">(</span>segmentations, height, width<span style="font-weight: bold">)</span>:                       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                <span style="color: #808000; text-decoration-color: #808000; font-style: italic">convert_rgb</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">convert_rgb</span><span style="font-weight: bold">(</span>image<span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Converts `PIL.Image.Image` to RGB format.</span>                  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>        <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_create_or_get_repo</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_create_or_get_repo</span><span style="font-weight: bold">(</span>repo_path_or_name: Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, repo_url:  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, organization: Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, private:   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              bool = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, use_auth_token: Union<span style="font-weight: bold">[</span>bool, str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span> -&gt;                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              huggingface_hub.repository.Repository:                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__delattr__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__delattr__</span><span style="font-weight: bold">(</span>name, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Implement </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">delattr</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">self, name</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                    <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__dir__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__dir__</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Default </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">dir</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">()</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> implementation.</span>                                       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>   <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_ensure_format_supported</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_ensure_format_supported</span><span style="font-weight: bold">(</span>image<span style="font-weight: bold">)</span>:                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                     <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__eq__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__eq__</span><span style="font-weight: bold">(</span>value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return </span><span style="color: #bfbf7f; text-decoration-color: #bfbf7f">self</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">==value.</span>                                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                <span style="color: #808000; text-decoration-color: #808000; font-style: italic">expand_dims</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">expand_dims</span><span style="font-weight: bold">(</span>image<span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Expands </span><span style="color: #7fbfbf; text-decoration-color: #7fbfbf; font-weight: bold">2</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">-dimensional `image` to </span><span style="color: #7fbfbf; text-decoration-color: #7fbfbf; font-weight: bold">3</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> dimensions.</span>             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                 <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__format__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__format__</span><span style="font-weight: bold">(</span>format_spec, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Default object formatter.</span>                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">from_dict</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">from_dict</span><span style="font-weight: bold">(</span>feature_extractor_dict: Dict<span style="font-weight: bold">[</span>str, Any<span style="font-weight: bold">]</span>, **kwargs<span style="font-weight: bold">)</span> -&gt;                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'SequenceFeatureExtractor'</span><span style="font-weight: bold">)</span>:                                            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Instantiates a type of </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`~feature_extraction_utils.FeatureExtractionMixin`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> from a</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Python dictionary of</span>                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">parameters.</span>                                                                        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>             <span style="color: #808000; text-decoration-color: #808000; font-style: italic">from_json_file</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">from_json_file</span><span style="font-weight: bold">(</span>json_file: Union<span style="font-weight: bold">[</span>str, os.PathLike<span style="font-weight: bold">])</span> -&gt;                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'SequenceFeatureExtractor'</span><span style="font-weight: bold">)</span>:                                            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Instantiates a feature extractor of type </span>                                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`~feature_extraction_utils.FeatureExtractionMixin`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> from the path to</span>              <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">a JSON file of parameters.</span>                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>            <span style="color: #808000; text-decoration-color: #808000; font-style: italic">from_pretrained</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">from_pretrained</span><span style="font-weight: bold">(</span>pretrained_model_name_or_path: Union<span style="font-weight: bold">[</span>str, os.PathLike<span style="font-weight: bold">]</span>,        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              **kwargs<span style="font-weight: bold">)</span> -&gt; <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'SequenceFeatureExtractor'</span><span style="font-weight: bold">)</span>:                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Instantiate a type of </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`~feature_extraction_utils.FeatureExtractionMixin`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> from a </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">feature extractor, *e.g.* a</span>                                                        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">derived class of </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`SequenceFeatureExtractor`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>                                     <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                     <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__ge__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__ge__</span><span style="font-weight: bold">(</span>value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return self&gt;=value.</span>                                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #808000; text-decoration-color: #808000; font-style: italic">get_feature_extractor_dict</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">get_feature_extractor_dict</span><span style="font-weight: bold">(</span>pretrained_model_name_or_path: Union<span style="font-weight: bold">[</span>str,           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              os.PathLike<span style="font-weight: bold">]</span>, **kwargs<span style="font-weight: bold">)</span> -&gt; Tuple<span style="font-weight: bold">[</span>Dict<span style="font-weight: bold">[</span>str, Any<span style="font-weight: bold">]</span>, Dict<span style="font-weight: bold">[</span>str, Any<span style="font-weight: bold">]]</span>:                  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">From a `pretrained_model_name_or_path`, resolve to a dictionary of parameters, to </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">be used for instantiating a</span>                                                        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">feature extractor of type </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`~feature_extraction_utils.FeatureExtractionMixin`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> </span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">using `from_dict`.</span>                                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>    <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_get_repo_url_from_name</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_get_repo_url_from_name</span><span style="font-weight: bold">(</span>repo_name: str, organization: Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> =   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, private: bool = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, use_auth_token: Union<span style="font-weight: bold">[</span>bool, str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span> -&gt;  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              str:                                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>           <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__getattribute__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__getattribute__</span><span style="font-weight: bold">(</span>name, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">getattr</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">self, name</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                     <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__gt__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__gt__</span><span style="font-weight: bold">(</span>value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return self&gt;value.</span>                                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                   <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__hash__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__hash__</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">hash</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">self</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                   <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__init__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__init__</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">format</span>=<span style="color: #008000; text-decoration-color: #008000">'coco_detection'</span>, <span style="color: #808000; text-decoration-color: #808000">do_resize</span>=<span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>, <span style="color: #808000; text-decoration-color: #808000">size</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">800</span>, <span style="color: #808000; text-decoration-color: #808000">max_size</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1333</span>,     <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #808000; text-decoration-color: #808000">do_normalize</span>=<span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>, <span style="color: #808000; text-decoration-color: #808000">image_mean</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, <span style="color: #808000; text-decoration-color: #808000">image_std</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, **kwargs<span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Set elements of </span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`kwargs` as attributes.</span>                                                            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>          <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__init_subclass__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__init_subclass__</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">)</span> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">This method is called when a class is subclassed.</span>       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>           <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_is_valid_format</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_is_valid_format</span><span style="font-weight: bold">(</span>format<span style="font-weight: bold">)</span>:                                                      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                     <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__le__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__le__</span><span style="font-weight: bold">(</span>value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return self&lt;=value.</span>                                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                     <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__lt__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__lt__</span><span style="font-weight: bold">(</span>value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return self&lt;value.</span>                                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>               <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_max_by_axis</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_max_by_axis</span><span style="font-weight: bold">(</span>the_list<span style="font-weight: bold">)</span>:                                                        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                     <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__ne__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__ne__</span><span style="font-weight: bold">(</span>value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return self!=value.</span>                                          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                    <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__new__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__new__</span><span style="font-weight: bold">(</span>*args, **kwargs<span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Create and return a new object.  See </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">help</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">type</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> for </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">accurate signature.</span>                                                                <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                 <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_normalize</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_normalize</span><span style="font-weight: bold">(</span>image, mean, std, <span style="color: #808000; text-decoration-color: #808000">target</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Normalize the image with a certain </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">mean and std.</span>                                                                      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">normalize</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">normalize</span><span style="font-weight: bold">(</span>image, mean, std<span style="font-weight: bold">)</span>:                                                   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Normalizes `image` with `mean` and `std`. Note that this will trigger a conversion</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">of `image` to a NumPy array</span>                                                        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">if it's a PIL Image.</span>                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">pad_and_create_pixel_mask</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">pad_and_create_pixel_mask</span><span style="font-weight: bold">(</span>pixel_values_list: List<span style="font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'torch.Tensor'</span><span style="font-weight: bold">)]</span>, <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              return_tensors: Union<span style="font-weight: bold">[</span>str, transformers.utils.generic.TensorType, NoneType<span style="font-weight: bold">]</span> =      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Pad images up to the largest image in a batch and create a corresponding </span>   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`pixel_mask`.</span>                                                                      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>               <span style="color: #808000; text-decoration-color: #808000; font-style: italic">post_process</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">post_process</span><span style="font-weight: bold">(</span>outputs, target_sizes<span style="font-weight: bold">)</span>:                                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Converts the output of </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`DetrForObjectDetection`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> into the format expected by the </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">COCO api. Only supports</span>                                                            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">PyTorch.</span>                                                                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>      <span style="color: #808000; text-decoration-color: #808000; font-style: italic">post_process_instance</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">post_process_instance</span><span style="font-weight: bold">(</span>results, outputs, orig_target_sizes, max_target_sizes,   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #808000; text-decoration-color: #808000">threshold</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5</span><span style="font-weight: bold">)</span>:                                                                    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Converts the output of </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`DetrForSegmentation`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> into actual instance segmentation </span>  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">predictions. Only supports</span>                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">PyTorch.</span>                                                                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>      <span style="color: #808000; text-decoration-color: #808000; font-style: italic">post_process_panoptic</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">post_process_panoptic</span><span style="font-weight: bold">(</span>outputs, processed_sizes, <span style="color: #808000; text-decoration-color: #808000">target_sizes</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>,             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #808000; text-decoration-color: #808000">is_thing_map</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, <span style="color: #808000; text-decoration-color: #808000">threshold</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.85</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Converts the output of </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`DetrForSegmentation`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">into actual panoptic predictions. Only supports PyTorch.</span>                           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>  <span style="color: #808000; text-decoration-color: #808000; font-style: italic">post_process_segmentation</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">post_process_segmentation</span><span style="font-weight: bold">(</span>outputs, target_sizes, <span style="color: #808000; text-decoration-color: #808000">threshold</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.9</span>,                <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #808000; text-decoration-color: #808000">mask_threshold</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Converts the output of </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`DetrForSegmentation`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> into image </span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">segmentation predictions. Only supports PyTorch.</span>                                   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                    <span style="color: #808000; text-decoration-color: #808000; font-style: italic">prepare</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">prepare</span><span style="font-weight: bold">(</span>image, target, <span style="color: #808000; text-decoration-color: #808000">return_segmentation_masks</span>=<span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>, <span style="color: #808000; text-decoration-color: #808000">masks_path</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span>:      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>     <span style="color: #808000; text-decoration-color: #808000; font-style: italic">prepare_coco_detection</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">prepare_coco_detection</span><span style="font-weight: bold">(</span>image, target, <span style="color: #808000; text-decoration-color: #808000">return_segmentation_masks</span>=<span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span><span style="font-weight: bold">)</span>:        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Convert the target in COCO format into the format expected by DETR.</span>                <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>      <span style="color: #808000; text-decoration-color: #808000; font-style: italic">prepare_coco_panoptic</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">prepare_coco_panoptic</span><span style="font-weight: bold">(</span>image, target, masks_path, <span style="color: #808000; text-decoration-color: #808000">return_masks</span>=<span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span><span style="font-weight: bold">)</span>:           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>               <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_push_to_hub</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_push_to_hub</span><span style="font-weight: bold">(</span>repo: huggingface_hub.repository.Repository, commit_message:      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span> -&gt; str:                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                <span style="color: #808000; text-decoration-color: #808000; font-style: italic">push_to_hub</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">push_to_hub</span><span style="font-weight: bold">(</span>repo_path_or_name: Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, repo_url:          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, use_temp_dir: bool = <span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>, commit_message:           <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, organization: Union<span style="font-weight: bold">[</span>str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, private:   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              Union<span style="font-weight: bold">[</span>bool, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, use_auth_token: Union<span style="font-weight: bold">[</span>bool, str, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>,   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              **model_card_kwargs<span style="font-weight: bold">)</span> -&gt; str:                                                       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Upload the feature extractor file to the 🤗 Model Hub while synchronizing a local </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">clone of the repo in</span>                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`repo_path_or_name`.</span>                                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                 <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__reduce__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__reduce__</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Helper for pickle.</span>                                               <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>              <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__reduce_ex__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__reduce_ex__</span><span style="font-weight: bold">(</span>protocol, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Helper for pickle.</span>                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>    <span style="color: #808000; text-decoration-color: #808000; font-style: italic">register_for_auto_class</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">register_for_auto_class</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">auto_class</span>=<span style="color: #008000; text-decoration-color: #008000">'AutoFeatureExtractor'</span><span style="font-weight: bold">)</span>:                    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Register this class with a given auto class. This should only be used for custom </span>  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">feature extractors as the ones</span>                                                     <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">in the library are already mapped with `AutoFeatureExtractor`.</span>                     <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                   <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__repr__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__repr__</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">repr</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">self</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                    <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_resize</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_resize</span><span style="font-weight: bold">(</span>image, size, <span style="color: #808000; text-decoration-color: #808000">target</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, <span style="color: #808000; text-decoration-color: #808000">max_size</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span>:                              <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Resize the image to the given size. Size can be min_size </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">scalar</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> or </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">w, h</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> tuple.</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">If size is an int, smaller</span>                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">edge of the image will be matched to this number.</span>                                  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                     <span style="color: #808000; text-decoration-color: #808000; font-style: italic">resize</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">resize</span><span style="font-weight: bold">(</span>image, size, <span style="color: #808000; text-decoration-color: #808000">resample</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2</span>, <span style="color: #808000; text-decoration-color: #808000">default_to_square</span>=<span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>, <span style="color: #808000; text-decoration-color: #808000">max_size</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span>:        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Resizes `image`. Enforces conversion of input to PIL.Image.</span>                        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>            <span style="color: #808000; text-decoration-color: #808000; font-style: italic">save_pretrained</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">save_pretrained</span><span style="font-weight: bold">(</span>save_directory: Union<span style="font-weight: bold">[</span>str, os.PathLike<span style="font-weight: bold">]</span>, push_to_hub: bool =   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>, **kwargs<span style="font-weight: bold">)</span>:                                                                  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Save a feature_extractor object to the directory `save_directory`, so that it can </span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">be re-loaded using the</span>                                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">[</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">`~feature_extraction_utils.FeatureExtractionMixin.from_pretrained`</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">]</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> class method.</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>       <span style="color: #808000; text-decoration-color: #808000; font-style: italic">_set_processor_class</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">_set_processor_class</span><span style="font-weight: bold">(</span>processor_class: str<span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Sets processor class as an </span>        <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">attribute.</span>                                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__setattr__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__setattr__</span><span style="font-weight: bold">(</span>name, value, <span style="color: #800080; text-decoration-color: #800080">/</span><span style="font-weight: bold">)</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Implement </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">setattr</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">self, name, value</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                 <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__sizeof__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__sizeof__</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Size of object in memory, in bytes.</span>                              <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                    <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__str__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__str__</span><span style="font-weight: bold">()</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Return </span><span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">str</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">(</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">self</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">)</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>                                                   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>           <span style="color: #bfbf7f; text-decoration-color: #bfbf7f; font-style: italic">__subclasshook__</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">__subclasshook__</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">...</span><span style="font-weight: bold">)</span> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Abstract classes can override this to customize </span>         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #bf7fbf; text-decoration-color: #bf7fbf; font-weight: bold">issubclass</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f; font-weight: bold">()</span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">.</span>                                                                      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                    <span style="color: #808000; text-decoration-color: #808000; font-style: italic">to_dict</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">to_dict</span><span style="font-weight: bold">()</span> -&gt; Dict<span style="font-weight: bold">[</span>str, Any<span style="font-weight: bold">]</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Serializes this instance to a Python dictionary.</span>  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>               <span style="color: #808000; text-decoration-color: #808000; font-style: italic">to_json_file</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">to_json_file</span><span style="font-weight: bold">(</span>json_file_path: Union<span style="font-weight: bold">[</span>str, os.PathLike<span style="font-weight: bold">])</span>: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Save this instance to a</span> <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">JSON file.</span>                                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>             <span style="color: #808000; text-decoration-color: #808000; font-style: italic">to_json_string</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">to_json_string</span><span style="font-weight: bold">()</span> -&gt; str: <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Serializes this instance to a JSON string.</span>            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>             <span style="color: #808000; text-decoration-color: #808000; font-style: italic">to_numpy_array</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">to_numpy_array</span><span style="font-weight: bold">(</span>image, <span style="color: #808000; text-decoration-color: #808000">rescale</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, <span style="color: #808000; text-decoration-color: #808000">channel_first</span>=<span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span><span style="font-weight: bold">)</span>:                       <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Converts `image` to a numpy array. Optionally rescales it and puts the channel </span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">dimension as the first</span>                                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">dimension.</span>                                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>               <span style="color: #808000; text-decoration-color: #808000; font-style: italic">to_pil_image</span> = <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">to_pil_image</span><span style="font-weight: bold">(</span>image, <span style="color: #808000; text-decoration-color: #808000">rescale</span>=<span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span><span style="font-weight: bold">)</span>:                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">Converts `image` to a PIL Image. Optionally rescales it and puts the channel </span>      <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">dimension back as the last axis if</span>                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                              <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">needed.</span>                                                                            <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
</pre>
</div>
</div>
<p>The output of inspect can be pretty verbose, but I often find this a handy tool for quickly trying to work out a new library of API.</p>
<p>We’ll look at the most critical parts in more detail, but I’ll point out a few things; you’ll see some attributes that will probably sound familiar.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>image_mean <span class="op">=</span> [<span class="fl">0.485</span>, <span class="fl">0.456</span>, <span class="fl">0.406</span>]                                                              </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>image_std <span class="op">=</span> [<span class="fl">0.229</span>, <span class="fl">0.224</span>, <span class="fl">0.225</span>]          </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These are the mean and standard deviation used during the model training. It’s essential when we’re doing inference or fine-tuning to replicate these, and having these all stored inside a <code>feature_extractor</code> means we don’t have to go poking around in papers to try and work out what these values should be.</p>
<p>Another thing to point out is the <code>push_to_hub</code> method. We can store <code>feature_extractor</code>s in the hub just as we can store models and tokenizers. Having to track the appropriate pre-processing steps for an image manually is super annoying to do manually. Storing this as we do other model components is much simpler and helps avoid errors resulting from tracing these things by hand.</p>
<p>The <code>__call__</code> method for the <code>DetrFeatureExtractor</code> is what we’ll use to prepare our images before we pass them into the model, let’s dig more closely into this.</p>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>inspect(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    feature_extractor.<span class="fu">__call__</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #000080; text-decoration-color: #000080">╭─ </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">bound</span><span style="color: #000000; text-decoration-color: #000000"> method DetrFeatureExtractor.__call__ of DetrFeatureExtractor </span><span style="color: #000000; text-decoration-color: #000000; font-weight: bold">{</span><span style="color: #000000; text-decoration-color: #000000">   </span><span style="color: #008000; text-decoration-color: #008000">"do_normalize"</span><span style="color: #000000; text-decoration-color: #000000">: true,   </span><span style="color: #008000; text-decoration-color: #008000">"do_resize"</span><span style="color: #000000; text-decoration-color: #000000">: t</span><span style="color: #000080; text-decoration-color: #000080">─╮</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #00ffff; text-decoration-color: #00ffff; font-style: italic">def </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">DetrFeatureExtractor.__call__</span><span style="font-weight: bold">(</span>images: Union<span style="font-weight: bold">[</span>PIL.Image.Image, numpy.ndarray, <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'torch.Tensor'</span><span style="font-weight: bold">)</span>,     <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> List<span style="font-weight: bold">[</span>PIL.Image.Image<span style="font-weight: bold">]</span>, List<span style="font-weight: bold">[</span>numpy.ndarray<span style="font-weight: bold">]</span>, List<span style="font-weight: bold">[</span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">ForwardRef</span><span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'torch.Tensor'</span><span style="font-weight: bold">)]]</span>, annotations: Union<span style="font-weight: bold">[</span>List<span style="font-weight: bold">[</span>Dict<span style="font-weight: bold">]</span>,   <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> List<span style="font-weight: bold">[</span>List<span style="font-weight: bold">[</span>Dict<span style="font-weight: bold">]]]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, return_segmentation_masks: Union<span style="font-weight: bold">[</span>bool, NoneType<span style="font-weight: bold">]</span> = <span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>, masks_path:                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> Union<span style="font-weight: bold">[</span>pathlib.Path, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, pad_and_return_pixel_mask: Union<span style="font-weight: bold">[</span>bool, NoneType<span style="font-weight: bold">]</span> = <span style="color: #00ff00; text-decoration-color: #00ff00; font-style: italic">True</span>, return_tensors:  <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> Union<span style="font-weight: bold">[</span>str, transformers.utils.generic.TensorType, NoneType<span style="font-weight: bold">]</span> = <span style="color: #800080; text-decoration-color: #800080; font-style: italic">None</span>, **kwargs<span style="font-weight: bold">)</span> -&gt;                                <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> transformers.feature_extraction_utils.BatchFeature:                                                             <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                                                                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008080; text-decoration-color: #008080">Main method to prepare for the model one or several </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">image</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080">s</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">)</span><span style="color: #008080; text-decoration-color: #008080"> and optional annotations. Images are by default</span>    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008080; text-decoration-color: #008080">padded up to the largest image in a batch, and a pixel mask is created that indicates which pixels are</span>          <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008080; text-decoration-color: #008080">real/which are padding.</span>                                                                                         <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span>                                                                                                                 <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">│</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">27</span><span style="font-style: italic"> attribute(s) not shown.</span> Run <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">inspect</span><span style="font-weight: bold">(</span>inspect<span style="font-weight: bold">)</span> for options.                                                    <span style="color: #000080; text-decoration-color: #000080">│</span>
<span style="color: #000080; text-decoration-color: #000080">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
</pre>
</div>
</div>
<p>Understanding what the <code>__call__</code> method expected, and how to make sure that is what’s delivered by the datasets library is the key thing I needed to work out. What does it expect:</p>
<ul>
<li><code>images</code>: this can be a list or a single image (and stored in different formats)</li>
<li><code>annotations</code> this should be of type <code>Union[List[Dict],││ List[List[Dict]]]</code>.</li>
</ul>
<p>The <code>images</code> part is not too tricky to understand. We can either pass in a single image, a NumPy array representing an image or a list of images or NumPy arrays.</p>
<p>The <code>annotations</code> part is where Python type annotations don’t always do us many favours since we only know we’re expecting a list of dictionaries, but we can safely assume those dictionaries probably need to have a particular format. We can try and see what happens if we pass in an image and a list of a random dictionary.</p>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> Image.<span class="bu">open</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    io.BytesIO(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        requests.get(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"https://hips.hearstapps.com/hmg-prod.s3.amazonaws.com/images/cute-cat-photos-1593441022.jpg?crop=1.00xw:0.749xh;0,0.154xh&amp;resize=980:*"</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        ).content</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>im</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2022-08-16-detr-object-detection_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-43" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: [</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.0</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>            <span class="dv">3</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>            <span class="dv">3</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>            <span class="dv">4</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>feature_extractor(im, labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Input <span class="ansi-green-fg">In [23]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">feature_extractor</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">im</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">labels</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/usr/local/Caskroom/miniforge/base/envs/blog/lib/python3.9/site-packages/transformers/models/detr/feature_extraction_detr.py:524</span>, in <span class="ansi-cyan-fg">DetrFeatureExtractor.__call__</span><span class="ansi-blue-fg">(self, images, annotations, return_segmentation_masks, masks_path, pad_and_return_pixel_mask, return_tensors, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    521</span>                         valid_annotations <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">True</span>
<span class="ansi-green-fg ansi-bold">    523</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> valid_annotations:
<span class="ansi-green-fg">--&gt; 524</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-fg ansi-bold">    525</span>             <span style="font-style:italic;color:rgb(175,0,0)">"""</span>
<span class="ansi-green-fg ansi-bold">    526</span> <span style="font-style:italic;color:rgb(175,0,0)">            Annotations must of type `Dict` (single image) or `List[Dict]` (batch of images). In case of object</span>
<span class="ansi-green-fg ansi-bold">    527</span> <span style="font-style:italic;color:rgb(175,0,0)">            detection, each dictionary should contain the keys 'image_id' and 'annotations', with the latter</span>
<span class="ansi-green-fg ansi-bold">    528</span> <span style="font-style:italic;color:rgb(175,0,0)">            being a list of annotations in COCO format. In case of panoptic segmentation, each dictionary</span>
<span class="ansi-green-fg ansi-bold">    529</span> <span style="font-style:italic;color:rgb(175,0,0)">            should contain the keys 'file_name', 'image_id' and 'segments_info', with the latter being a list</span>
<span class="ansi-green-fg ansi-bold">    530</span> <span style="font-style:italic;color:rgb(175,0,0)">            of annotations in COCO format.</span>
<span class="ansi-green-fg ansi-bold">    531</span> <span style="font-style:italic;color:rgb(175,0,0)">            """</span>
<span class="ansi-green-fg ansi-bold">    532</span>         )
<span class="ansi-green-fg ansi-bold">    534</span> <span style="font-style:italic;color:rgb(95,135,135)"># Check that masks_path has a valid type</span>
<span class="ansi-green-fg ansi-bold">    535</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> masks_path <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:

<span class="ansi-red-fg">ValueError</span>: 
                    Annotations must of type `Dict` (single image) or `List[Dict]` (batch of images). In case of object
                    detection, each dictionary should contain the keys 'image_id' and 'annotations', with the latter
                    being a list of annotations in COCO format. In case of panoptic segmentation, each dictionary
                    should contain the keys 'file_name', 'image_id' and 'segments_info', with the latter being a list
                    of annotations in COCO format.
                    </pre>
</div>
</div>
</div>
<p>We can see that this raises a <code>ValueError</code>. We also get some more information here that gives us a clue where we went wrong. Specifically we can see that the annotations for a single image should be a <code>Dict</code> or <code>List[Dict]</code> if we’re using a batch of images. We also see that we should pass in this data in the <code>COCO</code> format. Since our data is already in this format we should be able to pass in an example.</p>
<div id="cell-46" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> dataset[<span class="st">"train"</span>][<span class="dv">0</span>][<span class="st">"image"</span>]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2022-08-16-detr-object-detection_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>annotations <span class="op">=</span> dataset[<span class="st">"train"</span>][<span class="dv">0</span>][<span class="st">"objects"</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>annotations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span>
    <span style="font-weight: bold">{</span>
        <span style="color: #008000; text-decoration-color: #008000">'category_id'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span>,
        <span style="color: #008000; text-decoration-color: #008000">'image_id'</span>: <span style="color: #008000; text-decoration-color: #008000">'8081'</span>,
        <span style="color: #008000; text-decoration-color: #008000">'id'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">646</span>,
        <span style="color: #008000; text-decoration-color: #008000">'area'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">114552</span>,
        <span style="color: #008000; text-decoration-color: #008000">'bbox'</span>: <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">81.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">408.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">387.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">296.0</span><span style="font-weight: bold">]</span>,
        <span style="color: #008000; text-decoration-color: #008000">'segmentation'</span>: <span style="font-weight: bold">[[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">81.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">408.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">468.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">408.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">468.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">704.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">81.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">704.0</span><span style="font-weight: bold">]]</span>,
        <span style="color: #008000; text-decoration-color: #008000">'iscrowd'</span>: <span style="color: #ff0000; text-decoration-color: #ff0000; font-style: italic">False</span>
    <span style="font-weight: bold">}</span>
<span style="font-weight: bold">]</span>
</pre>
</div>
</div>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>feature_extractor(images<span class="op">=</span>image, annotations<span class="op">=</span>annotations, return_tensors<span class="op">=</span><span class="st">"pt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/var/folders/tj/54sfzlyj6_573fn82y996grc0000gr/T/ipykernel_47936/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">1569761185.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">&lt;cell line: </span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #00ff00; text-decoration-color: #00ff00">1&gt;</span>                                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000; font-style: italic">[Errno 2] No such file or directory: </span>                                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000; font-style: italic">'/var/folders/tj/54sfzlyj6_573fn82y996grc0000gr/T/ipykernel_47936/1569761185.py'</span>                 <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/usr/local/Caskroom/miniforge/base/envs/blog/lib/python3.9/site-packages/transformers/models/det</span> <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">r/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">feature_extraction_detr.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">524</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">__call__</span>                                                     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">521 │   │   │   │   │   │   │   │   </span>valid_annotations = <span style="color: #0000ff; text-decoration-color: #0000ff">True</span>                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">522 │   │   │   </span>                                                                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">523 │   │   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #ff00ff; text-decoration-color: #ff00ff">not</span> valid_annotations:                                                      <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>524 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> <span style="color: #00ffff; text-decoration-color: #00ffff">ValueError</span>(                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">525 │   │   │   │   │   </span><span style="color: #808000; text-decoration-color: #808000">"""</span>                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">526 </span><span style="color: #bfbf7f; text-decoration-color: #bfbf7f">│   │   │   │   │   </span><span style="color: #808000; text-decoration-color: #808000">Annotations must of type `Dict` (single image) or `List[Dict]` (batc</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">527 </span><span style="color: #bfbf7f; text-decoration-color: #bfbf7f">│   │   │   │   │   </span><span style="color: #808000; text-decoration-color: #808000">detection, each dictionary should contain the keys 'image_id' and 'a</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">ValueError: </span>
                    Annotations must of type `Dict` <span style="font-weight: bold">(</span>single image<span style="font-weight: bold">)</span> or `List<span style="font-weight: bold">[</span>Dict<span style="font-weight: bold">]</span>` <span style="font-weight: bold">(</span>batch of images<span style="font-weight: bold">)</span>. In case of 
object
                    detection, each dictionary should contain the keys <span style="color: #008000; text-decoration-color: #008000">'image_id'</span> and <span style="color: #008000; text-decoration-color: #008000">'annotations'</span>, with the 
latter
                    being a list of annotations in COCO format. In case of panoptic segmentation, each dictionary
                    should contain the keys <span style="color: #008000; text-decoration-color: #008000">'file_name'</span>, <span style="color: #008000; text-decoration-color: #008000">'image_id'</span> and <span style="color: #008000; text-decoration-color: #008000">'segments_info'</span>, with the latter being a 
list
                    of annotations in COCO format.
                    
</pre>
</div>
</div>
<p>Oh no! It still doesn’t work. At this point, it’s we probably either want to dig into the source code to work out what we should be passing to the <code>feature_extractor</code>. The relevant function is <a href="https://github.com/huggingface/transformers/blob/d6eeb871706db0d64ab9ffd79f9545d95286b536/src/transformers/models/detr/feature_extraction_detr.py#L214"><code>def prepare_coco_detection</code></a>.</p>
<p>We also have another <a href="https://github.com/NielsRogge/Transformers-Tutorials/blob/master/DETR/Fine_tuning_DetrForObjectDetection_on_custom_dataset_(balloon).ipynb">tutorial</a> to consult. In this tutorial we see that the annotations are stored in a dictionary <code>target</code> with the keys <code>image_id</code> and <code>annotations</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> {<span class="st">'image_id'</span>: image_id, <span class="st">'annotations'</span>: target}</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>encoding <span class="op">=</span> <span class="va">self</span>.feature_extractor(images<span class="op">=</span>img, annotations<span class="op">=</span>target, return_tensors<span class="op">=</span><span class="st">"pt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With a bit more wrangling let’s see if this works.</p>
<div id="cell-50" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> {<span class="st">"image_id"</span>: <span class="dv">4</span>, <span class="st">"annotations"</span>: annotations}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>feature_extractor(images<span class="op">=</span>image, annotations<span class="op">=</span>target, return_tensors<span class="op">=</span><span class="st">"pt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'pixel_values'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([[[[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.7650</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9705</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9705</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.4158</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.7822</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9020</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9020</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3644</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.4500</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8164</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9020</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9192</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.4500</span><span style="font-weight: bold">]</span>,
          <span style="color: #808000; text-decoration-color: #808000">...</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5297</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5639</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5810</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4612</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4612</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4783</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5297</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5468</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4783</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4783</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4954</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4954</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5297</span><span style="font-weight: bold">]]</span>,

         <span style="font-weight: bold">[[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6527</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8627</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8627</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3179</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2829</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2829</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.7052</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8102</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8277</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3004</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2829</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3704</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.7402</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8102</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8277</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3529</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3529</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.4405</span><span style="font-weight: bold">]</span>,
          <span style="color: #808000; text-decoration-color: #808000">...</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5357</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5707</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5882</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3957</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3957</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4132</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5182</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5357</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5532</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4132</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4132</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4307</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5007</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5182</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5182</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4482</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4482</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4657</span><span style="font-weight: bold">]]</span>,

         <span style="font-weight: bold">[[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.4275</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6367</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6367</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.1073</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.0898</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.0898</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.4624</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.5670</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.5844</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.1247</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.1247</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2119</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.5147</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6018</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6193</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2293</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2467</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3339</span><span style="font-weight: bold">]</span>,
          <span style="color: #808000; text-decoration-color: #808000">...</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4548</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4897</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5071</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3154</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3154</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3328</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4374</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4548</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4722</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3328</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3328</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3502</span><span style="font-weight: bold">]</span>,
          <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4200</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4374</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4374</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3677</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3677</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3851</span><span style="font-weight: bold">]]]])</span>,
    <span style="color: #008000; text-decoration-color: #008000">'pixel_mask'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([[[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
         <span style="color: #808000; text-decoration-color: #808000">...</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]]])</span>,
    <span style="color: #008000; text-decoration-color: #008000">'labels'</span>: <span style="font-weight: bold">[</span>
        <span style="font-weight: bold">{</span>
            <span style="color: #008000; text-decoration-color: #008000">'boxes'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.4575</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5120</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.6450</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.2726</span><span style="font-weight: bold">]])</span>,
            <span style="color: #008000; text-decoration-color: #008000">'class_labels'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="font-weight: bold">])</span>,
            <span style="color: #008000; text-decoration-color: #008000">'image_id'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4</span><span style="font-weight: bold">])</span>,
            <span style="color: #008000; text-decoration-color: #008000">'area'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">172346.9688</span><span style="font-weight: bold">])</span>,
            <span style="color: #008000; text-decoration-color: #008000">'iscrowd'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="font-weight: bold">])</span>,
            <span style="color: #008000; text-decoration-color: #008000">'orig_size'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1086</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">600</span><span style="font-weight: bold">])</span>,
            <span style="color: #008000; text-decoration-color: #008000">'size'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1332</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">736</span><span style="font-weight: bold">])</span>
        <span style="font-weight: bold">}</span>
    <span style="font-weight: bold">]</span>
<span style="font-weight: bold">}</span>
</pre>
</div>
</div>
<p>This is looking more like it! Now we have one example working we can translate this to a function that can prepare a batch into the same format.</p>
<p>Since we get a batch at a time we might need to refactor things slightly. In this example I’ve just grabbed the relevant lists for the images, image_id and annotations. We then use a list compression to store these in the dictionary format expected by the <code>feature_extractor</code>.</p>
<div id="cell-53" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transform(example_batch):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    images <span class="op">=</span> example_batch[<span class="st">"image"</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    ids_ <span class="op">=</span> example_batch[<span class="st">"image_id"</span>]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    objects <span class="op">=</span> example_batch[<span class="st">"objects"</span>]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    targets <span class="op">=</span> [</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"image_id"</span>: id_, <span class="st">"annotations"</span>: object_} <span class="cf">for</span> id_, object_ <span class="kw">in</span> <span class="bu">zip</span>(ids_, objects)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature_extractor(images<span class="op">=</span>images, annotations<span class="op">=</span>targets, return_tensors<span class="op">=</span><span class="st">"pt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could apply this to our data using <code>map</code> but it often makes more sense to applay these on the fly using the <code>with_transform</code> method.</p>
<div id="cell-55" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dataset[<span class="st">"train"</span>] <span class="op">=</span> dataset[<span class="st">"train"</span>].with_transform(transform)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at an example</p>
<div id="cell-57" class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dataset[<span class="st">"train"</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'pixel_values'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([[[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.7650</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9705</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9705</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.4158</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.7822</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9020</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9020</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3644</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.4500</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8164</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9020</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.9192</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3815</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.4500</span><span style="font-weight: bold">]</span>,
         <span style="color: #808000; text-decoration-color: #808000">...</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5297</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5639</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5810</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4612</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4612</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4783</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5297</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5468</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4783</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4783</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4954</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4954</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5125</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5297</span><span style="font-weight: bold">]]</span>,

        <span style="font-weight: bold">[[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6527</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8627</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8627</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3179</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2829</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2829</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.7052</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8102</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8277</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3004</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2829</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3704</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.7402</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8102</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.8277</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3529</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3529</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.4405</span><span style="font-weight: bold">]</span>,
         <span style="color: #808000; text-decoration-color: #808000">...</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5357</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5707</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5882</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3957</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3957</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4132</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5182</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5357</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5532</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4132</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4132</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4307</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5007</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5182</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5182</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4482</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4482</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4657</span><span style="font-weight: bold">]]</span>,

        <span style="font-weight: bold">[[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.4275</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6367</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6367</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.1073</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.0898</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.0898</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.4624</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.5670</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.5844</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.1247</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.1247</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2119</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.5147</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6018</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.6193</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2293</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.2467</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.3339</span><span style="font-weight: bold">]</span>,
         <span style="color: #808000; text-decoration-color: #808000">...</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4548</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4897</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.5071</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3154</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3154</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3328</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4374</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4548</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4722</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3328</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3328</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3502</span><span style="font-weight: bold">]</span>,
         <span style="font-weight: bold">[</span> <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4200</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4374</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4374</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3677</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3677</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.3851</span><span style="font-weight: bold">]]])</span>,
    <span style="color: #008000; text-decoration-color: #008000">'pixel_mask'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
        <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
        <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
        <span style="color: #808000; text-decoration-color: #808000">...</span>,
        <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
        <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]</span>,
        <span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>,  <span style="color: #808000; text-decoration-color: #808000">...</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">]])</span>,
    <span style="color: #008000; text-decoration-color: #008000">'labels'</span>: <span style="font-weight: bold">{</span>
        <span style="color: #008000; text-decoration-color: #008000">'boxes'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.4575</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5120</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.6450</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.2726</span><span style="font-weight: bold">]])</span>,
        <span style="color: #008000; text-decoration-color: #008000">'class_labels'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="font-weight: bold">])</span>,
        <span style="color: #008000; text-decoration-color: #008000">'image_id'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8081</span><span style="font-weight: bold">])</span>,
        <span style="color: #008000; text-decoration-color: #008000">'area'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">172346.9688</span><span style="font-weight: bold">])</span>,
        <span style="color: #008000; text-decoration-color: #008000">'iscrowd'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="font-weight: bold">])</span>,
        <span style="color: #008000; text-decoration-color: #008000">'orig_size'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1086</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">600</span><span style="font-weight: bold">])</span>,
        <span style="color: #008000; text-decoration-color: #008000">'size'</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">tensor</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1332</span>,  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">736</span><span style="font-weight: bold">])</span>
    <span style="font-weight: bold">}</span>
<span style="font-weight: bold">}</span>
</pre>
</div>
</div>
<p>The next thing we need to take care of is a collate function. ‘Data collators are objects that will form a batch by using a list of dataset elements as input. These elements are of the same type as the elements of train_dataset or eval_dataset.’ <a href="https://huggingface.co/docs/transformers/main_classes/data_collator#data-collator">source</a>.</p>
<div id="cell-59" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> collate_fn(batch):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    pixel_values <span class="op">=</span> [item[<span class="st">"pixel_values"</span>] <span class="cf">for</span> item <span class="kw">in</span> batch]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    encoding <span class="op">=</span> feature_extractor.pad_and_create_pixel_mask(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>        pixel_values, return_tensors<span class="op">=</span><span class="st">"pt"</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [item[<span class="st">"labels"</span>] <span class="cf">for</span> item <span class="kw">in</span> batch]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    batch <span class="op">=</span> {} <span class="co"># collated batch  </span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    batch[<span class="st">'pixel_values'</span>] <span class="op">=</span> encoding[<span class="st">'pixel_values'</span>]</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    batch[<span class="st">"pixel_mask"</span>] <span class="op">=</span> encoding[<span class="st">"pixel_mask"</span>]</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    batch[<span class="st">"labels"</span>] <span class="op">=</span> labels</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> batch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="creating-a-detr-model" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-detr-model">Creating a detr model</h2>
<section id="avoiding-ambiguous-labels" class="level3">
<h3 class="anchored" data-anchor-id="avoiding-ambiguous-labels">Avoiding ambiguous labels</h3>
<p>We’re almost at the point where we can start training the model. We just do a little bit of housekeeping to make sure our model knows what our encoded labels are. It’s super annoying when you are trying a model out on the Hugging Face Hub and you get back labels, <code>0</code> or <code>3</code> with no clue what these labels refer to. We can avoid this by telling our model what labels we have. This mapping will then be bundled with the model when we push it to the hub.</p>
<div id="cell-62" class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>id2label <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">enumerate</span>(dataset[<span class="st">"train"</span>].features[<span class="st">"objects"</span>][<span class="dv">0</span>][<span class="st">"category_id"</span>].names))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>label2id <span class="op">=</span> {v: k <span class="cf">for</span> k, v <span class="kw">in</span> id2label.items()}</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>label2id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'early_printed_illustration'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="font-weight: bold">}</span>
</pre>
</div>
</div>
<p>Now we can create the <code>DetrForObjectDetection</code> model. This should all look familiar if you’ve used transformers for other tasks.</p>
<div id="cell-64" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> DetrForObjectDetection</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> DetrForObjectDetection.from_pretrained(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    model_checkpoint,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    num_labels<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    id2label<span class="op">=</span>id2label,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    label2id<span class="op">=</span>label2id,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    ignore_mismatched_sizes<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c3775a8de4f8426eaafbb2570d43b825","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"92632e6620094d18a2e86ff4286d3486","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading: "https://github.com/rwightman/pytorch-image-models/releases/download/v0.1-rsb-weights/resnet50_a1_0-14fe96d1.pth" to /root/.cache/torch/hub/checkpoints/resnet50_a1_0-14fe96d1.pth
Some weights of DetrForObjectDetection were not initialized from the model checkpoint at facebook/detr-resnet-50 and are newly initialized because the shapes did not match:
- class_labels_classifier.weight: found shape torch.Size([92, 256]) in the checkpoint and torch.Size([2, 256]) in the model instantiated
- class_labels_classifier.bias: found shape torch.Size([92]) in the checkpoint and torch.Size([2]) in the model instantiated
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.</code></pre>
</div>
</div>
<p>If you wanted to use another backbone you could do something like:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from transformers import DetrForObjectDetection</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># config = DetrConfig(backbone='regnetz_e8',id2label=id2label, label2id=label2id)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model = DetrForObjectDetection(config)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="training-the-detr-model" class="level2">
<h2 class="anchored" data-anchor-id="training-the-detr-model">Training the detr model</h2>
<p>We now specify our <code>TrainingArguments</code></p>
<div id="cell-68" class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> TrainingArguments</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>training_args <span class="op">=</span> TrainingArguments(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    output_dir<span class="op">=</span><span class="st">"detr-resnet-50_fine_tuned_nls_chapbooks"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    per_device_train_batch_size<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    num_train_epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    fp16<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    save_steps<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    logging_steps<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">1e-4</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    save_total_limit<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    remove_unused_columns<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    push_to_hub<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    hub_model_id<span class="op">=</span><span class="st">"davanstrien/detr-resnet-50_fine_tuned_nls_chapbooks"</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and create our <code>Trainer</code></p>
<div id="cell-70" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> Trainer</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> Trainer(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>model,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    args<span class="op">=</span>training_args,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    data_collator<span class="op">=</span>collate_fn,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    train_dataset<span class="op">=</span>dataset[<span class="st">"train"</span>],</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    tokenizer<span class="op">=</span>feature_extractor,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Cloning https://huggingface.co/davanstrien/detr-resnet-50_fine_tuned_nls_chapbooks into local empty directory.</code></pre>
</div>
</div>
<div id="cell-71" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#collapse</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>trainer.train()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.7/dist-packages/transformers/optimization.py:310: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  FutureWarning,
***** Running training *****
  Num examples = 6531
  Num Epochs = 10
  Instantaneous batch size per device = 8
  Total train batch size (w. parallel, distributed &amp; accumulation) = 8
  Gradient Accumulation steps = 1
  Total optimization steps = 8170
Automatic Weights &amp; Biases logging enabled, to disable set os.environ["WANDB_DISABLED"] = "true"</code></pre>
</div>
<div class="cell-output cell-output-display">
Changes to your `wandb` environment variables will be ignored because your `wandb` session has already started. For more information on how to modify your settings with `wandb.init()` arguments, please refer to <a href="https://wandb.me/wandb-init" target="_blank">the W&amp;B docs</a>.
</div>
<div class="cell-output cell-output-stderr">
<pre><code>wandb: Currently logged in as: davanstrien (flyswot). Use `wandb login --relogin` to force relogin</code></pre>
</div>
<div class="cell-output cell-output-display">
Tracking run with wandb version 0.12.21
</div>
<div class="cell-output cell-output-display">
Run data is saved locally in <code>/content/wandb/run-20220724_144321-sgzdksxm</code>
</div>
<div class="cell-output cell-output-display">
Syncing run <strong><a href="https://wandb.ai/davanstrien/chapbooks/runs/sgzdksxm" target="_blank">detr-resnet-50_fine_tuned_nls_chapbooks</a></strong> to <a href="https://wandb.ai/davanstrien/chapbooks" target="_blank">Weights &amp; Biases</a> (<a href="https://wandb.me/run" target="_blank">docs</a>)<br>
</div>
<div class="cell-output cell-output-display">

    <div>
      
      <progress value="8170" max="8170" style="width:300px; height:20px; vertical-align: middle;"></progress>
      [8170/8170 5:15:38, Epoch 10/10]
    </div>
    
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Step</th>
<th data-quarto-table-cell-role="th">Training Loss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50</td>
<td>1.975700</td>
</tr>
<tr class="even">
<td>100</td>
<td>3.254000</td>
</tr>
<tr class="odd">
<td>150</td>
<td>1.563300</td>
</tr>
<tr class="even">
<td>200</td>
<td>1.103100</td>
</tr>
<tr class="odd">
<td>250</td>
<td>1.468000</td>
</tr>
<tr class="even">
<td>300</td>
<td>1.169700</td>
</tr>
<tr class="odd">
<td>350</td>
<td>1.326600</td>
</tr>
<tr class="even">
<td>400</td>
<td>1.413800</td>
</tr>
<tr class="odd">
<td>450</td>
<td>1.101600</td>
</tr>
<tr class="even">
<td>500</td>
<td>1.054500</td>
</tr>
<tr class="odd">
<td>550</td>
<td>0.946000</td>
</tr>
<tr class="even">
<td>600</td>
<td>0.871600</td>
</tr>
<tr class="odd">
<td>650</td>
<td>0.723600</td>
</tr>
<tr class="even">
<td>700</td>
<td>0.866800</td>
</tr>
<tr class="odd">
<td>750</td>
<td>0.740400</td>
</tr>
<tr class="even">
<td>800</td>
<td>0.753300</td>
</tr>
<tr class="odd">
<td>850</td>
<td>0.748900</td>
</tr>
<tr class="even">
<td>900</td>
<td>0.919600</td>
</tr>
<tr class="odd">
<td>950</td>
<td>0.805800</td>
</tr>
<tr class="even">
<td>1000</td>
<td>0.902200</td>
</tr>
<tr class="odd">
<td>1050</td>
<td>0.788800</td>
</tr>
<tr class="even">
<td>1100</td>
<td>0.734400</td>
</tr>
<tr class="odd">
<td>1150</td>
<td>0.635700</td>
</tr>
<tr class="even">
<td>1200</td>
<td>0.769000</td>
</tr>
<tr class="odd">
<td>1250</td>
<td>0.673000</td>
</tr>
<tr class="even">
<td>1300</td>
<td>0.766200</td>
</tr>
<tr class="odd">
<td>1350</td>
<td>0.664800</td>
</tr>
<tr class="even">
<td>1400</td>
<td>0.653700</td>
</tr>
<tr class="odd">
<td>1450</td>
<td>0.589500</td>
</tr>
<tr class="even">
<td>1500</td>
<td>0.580900</td>
</tr>
<tr class="odd">
<td>1550</td>
<td>0.583200</td>
</tr>
<tr class="even">
<td>1600</td>
<td>0.736000</td>
</tr>
<tr class="odd">
<td>1650</td>
<td>0.594900</td>
</tr>
<tr class="even">
<td>1700</td>
<td>0.701400</td>
</tr>
<tr class="odd">
<td>1750</td>
<td>0.600300</td>
</tr>
<tr class="even">
<td>1800</td>
<td>0.470900</td>
</tr>
<tr class="odd">
<td>1850</td>
<td>0.522800</td>
</tr>
<tr class="even">
<td>1900</td>
<td>0.590300</td>
</tr>
<tr class="odd">
<td>1950</td>
<td>0.566300</td>
</tr>
<tr class="even">
<td>2000</td>
<td>0.586800</td>
</tr>
<tr class="odd">
<td>2050</td>
<td>0.623800</td>
</tr>
<tr class="even">
<td>2100</td>
<td>0.523400</td>
</tr>
<tr class="odd">
<td>2150</td>
<td>0.562500</td>
</tr>
<tr class="even">
<td>2200</td>
<td>0.604100</td>
</tr>
<tr class="odd">
<td>2250</td>
<td>0.518000</td>
</tr>
<tr class="even">
<td>2300</td>
<td>0.525100</td>
</tr>
<tr class="odd">
<td>2350</td>
<td>0.499100</td>
</tr>
<tr class="even">
<td>2400</td>
<td>0.564900</td>
</tr>
<tr class="odd">
<td>2450</td>
<td>0.455100</td>
</tr>
<tr class="even">
<td>2500</td>
<td>0.465000</td>
</tr>
<tr class="odd">
<td>2550</td>
<td>0.533200</td>
</tr>
<tr class="even">
<td>2600</td>
<td>0.512500</td>
</tr>
<tr class="odd">
<td>2650</td>
<td>0.465100</td>
</tr>
<tr class="even">
<td>2700</td>
<td>0.521800</td>
</tr>
<tr class="odd">
<td>2750</td>
<td>0.519500</td>
</tr>
<tr class="even">
<td>2800</td>
<td>0.456800</td>
</tr>
<tr class="odd">
<td>2850</td>
<td>0.444400</td>
</tr>
<tr class="even">
<td>2900</td>
<td>0.429600</td>
</tr>
<tr class="odd">
<td>2950</td>
<td>0.445400</td>
</tr>
<tr class="even">
<td>3000</td>
<td>0.425600</td>
</tr>
<tr class="odd">
<td>3050</td>
<td>0.439600</td>
</tr>
<tr class="even">
<td>3100</td>
<td>0.468000</td>
</tr>
<tr class="odd">
<td>3150</td>
<td>0.426500</td>
</tr>
<tr class="even">
<td>3200</td>
<td>0.433500</td>
</tr>
<tr class="odd">
<td>3250</td>
<td>0.479400</td>
</tr>
<tr class="even">
<td>3300</td>
<td>0.421800</td>
</tr>
<tr class="odd">
<td>3350</td>
<td>0.449500</td>
</tr>
<tr class="even">
<td>3400</td>
<td>0.399300</td>
</tr>
<tr class="odd">
<td>3450</td>
<td>0.424500</td>
</tr>
<tr class="even">
<td>3500</td>
<td>0.447700</td>
</tr>
<tr class="odd">
<td>3550</td>
<td>0.428900</td>
</tr>
<tr class="even">
<td>3600</td>
<td>0.403800</td>
</tr>
<tr class="odd">
<td>3650</td>
<td>0.448300</td>
</tr>
<tr class="even">
<td>3700</td>
<td>0.424300</td>
</tr>
<tr class="odd">
<td>3750</td>
<td>0.396600</td>
</tr>
<tr class="even">
<td>3800</td>
<td>0.405900</td>
</tr>
<tr class="odd">
<td>3850</td>
<td>0.436300</td>
</tr>
<tr class="even">
<td>3900</td>
<td>0.371500</td>
</tr>
<tr class="odd">
<td>3950</td>
<td>0.412300</td>
</tr>
<tr class="even">
<td>4000</td>
<td>0.389200</td>
</tr>
<tr class="odd">
<td>4050</td>
<td>0.391900</td>
</tr>
<tr class="even">
<td>4100</td>
<td>0.403200</td>
</tr>
<tr class="odd">
<td>4150</td>
<td>0.386800</td>
</tr>
<tr class="even">
<td>4200</td>
<td>0.382500</td>
</tr>
<tr class="odd">
<td>4250</td>
<td>0.402000</td>
</tr>
<tr class="even">
<td>4300</td>
<td>0.374400</td>
</tr>
<tr class="odd">
<td>4350</td>
<td>0.355900</td>
</tr>
<tr class="even">
<td>4400</td>
<td>0.390800</td>
</tr>
<tr class="odd">
<td>4450</td>
<td>0.402600</td>
</tr>
<tr class="even">
<td>4500</td>
<td>0.397100</td>
</tr>
<tr class="odd">
<td>4550</td>
<td>0.399700</td>
</tr>
<tr class="even">
<td>4600</td>
<td>0.363900</td>
</tr>
<tr class="odd">
<td>4650</td>
<td>0.373600</td>
</tr>
<tr class="even">
<td>4700</td>
<td>0.391600</td>
</tr>
<tr class="odd">
<td>4750</td>
<td>0.339200</td>
</tr>
<tr class="even">
<td>4800</td>
<td>0.351900</td>
</tr>
<tr class="odd">
<td>4850</td>
<td>0.381800</td>
</tr>
<tr class="even">
<td>4900</td>
<td>0.381800</td>
</tr>
<tr class="odd">
<td>4950</td>
<td>0.326000</td>
</tr>
<tr class="even">
<td>5000</td>
<td>0.388300</td>
</tr>
<tr class="odd">
<td>5050</td>
<td>0.359100</td>
</tr>
<tr class="even">
<td>5100</td>
<td>0.380500</td>
</tr>
<tr class="odd">
<td>5150</td>
<td>0.357100</td>
</tr>
<tr class="even">
<td>5200</td>
<td>0.389500</td>
</tr>
<tr class="odd">
<td>5250</td>
<td>0.386200</td>
</tr>
<tr class="even">
<td>5300</td>
<td>0.373000</td>
</tr>
<tr class="odd">
<td>5350</td>
<td>0.340000</td>
</tr>
<tr class="even">
<td>5400</td>
<td>0.337100</td>
</tr>
<tr class="odd">
<td>5450</td>
<td>0.357500</td>
</tr>
<tr class="even">
<td>5500</td>
<td>0.338900</td>
</tr>
<tr class="odd">
<td>5550</td>
<td>0.334500</td>
</tr>
<tr class="even">
<td>5600</td>
<td>0.362000</td>
</tr>
<tr class="odd">
<td>5650</td>
<td>0.426100</td>
</tr>
<tr class="even">
<td>5700</td>
<td>0.329500</td>
</tr>
<tr class="odd">
<td>5750</td>
<td>0.321500</td>
</tr>
<tr class="even">
<td>5800</td>
<td>0.328800</td>
</tr>
<tr class="odd">
<td>5850</td>
<td>0.322400</td>
</tr>
<tr class="even">
<td>5900</td>
<td>0.385900</td>
</tr>
<tr class="odd">
<td>5950</td>
<td>0.373800</td>
</tr>
<tr class="even">
<td>6000</td>
<td>0.326000</td>
</tr>
<tr class="odd">
<td>6050</td>
<td>0.335200</td>
</tr>
<tr class="even">
<td>6100</td>
<td>0.341600</td>
</tr>
<tr class="odd">
<td>6150</td>
<td>0.309600</td>
</tr>
<tr class="even">
<td>6200</td>
<td>0.295700</td>
</tr>
<tr class="odd">
<td>6250</td>
<td>0.338600</td>
</tr>
<tr class="even">
<td>6300</td>
<td>0.326800</td>
</tr>
<tr class="odd">
<td>6350</td>
<td>0.305600</td>
</tr>
<tr class="even">
<td>6400</td>
<td>0.287200</td>
</tr>
<tr class="odd">
<td>6450</td>
<td>0.307700</td>
</tr>
<tr class="even">
<td>6500</td>
<td>0.297000</td>
</tr>
<tr class="odd">
<td>6550</td>
<td>0.296700</td>
</tr>
<tr class="even">
<td>6600</td>
<td>0.292700</td>
</tr>
<tr class="odd">
<td>6650</td>
<td>0.305300</td>
</tr>
<tr class="even">
<td>6700</td>
<td>0.289300</td>
</tr>
<tr class="odd">
<td>6750</td>
<td>0.290600</td>
</tr>
<tr class="even">
<td>6800</td>
<td>0.277100</td>
</tr>
<tr class="odd">
<td>6850</td>
<td>0.296500</td>
</tr>
<tr class="even">
<td>6900</td>
<td>0.291800</td>
</tr>
<tr class="odd">
<td>6950</td>
<td>0.285800</td>
</tr>
<tr class="even">
<td>7000</td>
<td>0.291400</td>
</tr>
<tr class="odd">
<td>7050</td>
<td>0.282500</td>
</tr>
<tr class="even">
<td>7100</td>
<td>0.271500</td>
</tr>
<tr class="odd">
<td>7150</td>
<td>0.278300</td>
</tr>
<tr class="even">
<td>7200</td>
<td>0.272100</td>
</tr>
<tr class="odd">
<td>7250</td>
<td>0.273800</td>
</tr>
<tr class="even">
<td>7300</td>
<td>0.313500</td>
</tr>
<tr class="odd">
<td>7350</td>
<td>0.288600</td>
</tr>
<tr class="even">
<td>7400</td>
<td>0.258700</td>
</tr>
<tr class="odd">
<td>7450</td>
<td>0.275700</td>
</tr>
<tr class="even">
<td>7500</td>
<td>0.248200</td>
</tr>
<tr class="odd">
<td>7550</td>
<td>0.280800</td>
</tr>
<tr class="even">
<td>7600</td>
<td>0.268500</td>
</tr>
<tr class="odd">
<td>7650</td>
<td>0.258700</td>
</tr>
<tr class="even">
<td>7700</td>
<td>0.302800</td>
</tr>
<tr class="odd">
<td>7750</td>
<td>0.288700</td>
</tr>
<tr class="even">
<td>7800</td>
<td>0.278400</td>
</tr>
<tr class="odd">
<td>7850</td>
<td>0.260700</td>
</tr>
<tr class="even">
<td>7900</td>
<td>0.271200</td>
</tr>
<tr class="odd">
<td>7950</td>
<td>0.247900</td>
</tr>
<tr class="even">
<td>8000</td>
<td>0.234700</td>
</tr>
<tr class="odd">
<td>8050</td>
<td>0.263900</td>
</tr>
<tr class="even">
<td>8100</td>
<td>0.251900</td>
</tr>
<tr class="odd">
<td>8150</td>
<td>0.246900</td>
</tr>
</tbody>
</table>
<p>
</p></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-200
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-200/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-200/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-200/preprocessor_config.json
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/preprocessor_config.json
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-400
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-400/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-400/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-400/preprocessor_config.json
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-600
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-600/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-600/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-600/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-200] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-800
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-800/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-800/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-800/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-400] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1000
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1000/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1000/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1000/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-600] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1200
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1200/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1200/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1200/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-800] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1400
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1400/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1400/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1400/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1000] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1600
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1600/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1600/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1600/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1200] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1800
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1800/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1800/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1800/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1400] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2000
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2000/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2000/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2000/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1600] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2200
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2200/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2200/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2200/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-1800] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2400
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2400/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2400/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2400/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2000] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2600
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2600/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2600/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2600/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2200] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2800
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2800/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2800/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2800/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2400] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3000
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3000/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3000/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3000/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2600] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3200
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3200/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3200/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3200/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-2800] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3400
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3400/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3400/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3400/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3000] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3600
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3600/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3600/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3600/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3200] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3800
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3800/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3800/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3800/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3400] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4000
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4000/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4000/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4000/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3600] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4200
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4200/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4200/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4200/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-3800] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4400
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4400/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4400/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4400/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4000] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4600
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4600/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4600/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4600/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4200] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4800
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4800/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4800/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4800/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4400] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5000
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5000/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5000/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5000/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4600] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5200
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5200/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5200/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5200/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-4800] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5400
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5400/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5400/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5400/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5000] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5600
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5600/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5600/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5600/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5200] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5800
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5800/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5800/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5800/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5400] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6000
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6000/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6000/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6000/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5600] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6200
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6200/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6200/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6200/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-5800] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6400
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6400/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6400/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6400/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6000] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6600
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6600/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6600/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6600/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6200] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6800
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6800/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6800/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6800/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6400] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7000
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7000/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7000/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7000/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6600] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7200
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7200/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7200/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7200/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-6800] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7400
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7400/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7400/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7400/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7000] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7600
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7600/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7600/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7600/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7200] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7800
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7800/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7800/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7800/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7400] due to args.save_total_limit
Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-8000
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-8000/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-8000/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-8000/preprocessor_config.json
Deleting older checkpoint [detr-resnet-50_fine_tuned_nls_chapbooks/checkpoint-7600] due to args.save_total_limit


Training completed. Do not forget to share your model on huggingface.co/models =)

</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">TrainOutput</span><span style="font-weight: bold">(</span>
    <span style="color: #808000; text-decoration-color: #808000">global_step</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8170</span>,
    <span style="color: #808000; text-decoration-color: #808000">training_loss</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5031144771902768</span>,
    <span style="color: #808000; text-decoration-color: #808000">metrics</span>=<span style="font-weight: bold">{</span>
        <span style="color: #008000; text-decoration-color: #008000">'train_runtime'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">18954.8014</span>,
        <span style="color: #008000; text-decoration-color: #008000">'train_samples_per_second'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.446</span>,
        <span style="color: #008000; text-decoration-color: #008000">'train_steps_per_second'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.431</span>,
        <span style="color: #008000; text-decoration-color: #008000">'total_flos'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.190134584879058e+19</span>,
        <span style="color: #008000; text-decoration-color: #008000">'train_loss'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5031144771902768</span>,
        <span style="color: #008000; text-decoration-color: #008000">'epoch'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">10.0</span>
    <span style="font-weight: bold">}</span>
<span style="font-weight: bold">)</span>
</pre>
</div>
</div>
<p>Once we’ve finished training we can use <code>push_to_hub</code> to share our model on the hub.</p>
<div id="cell-73" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>trainer.push_to_hub(<span class="st">"finished training"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving model checkpoint to detr-resnet-50_fine_tuned_nls_chapbooks
Configuration saved in detr-resnet-50_fine_tuned_nls_chapbooks/config.json
Model weights saved in detr-resnet-50_fine_tuned_nls_chapbooks/pytorch_model.bin
Feature extractor saved in detr-resnet-50_fine_tuned_nls_chapbooks/preprocessor_config.json
Several commits (2) will be pushed upstream.
The progress bars may be unreliable.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5bf4c2600b6648d6a30183acd31b1125","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2ec3e4ed00f24da0b496d3d801971eeb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>To https://huggingface.co/davanstrien/detr-resnet-50_fine_tuned_nls_chapbooks
   c94bb78..5c7b9d8  main -&gt; main

Dropping the following result as it does not have all the necessary fields:
{'task': {'name': 'Object Detection', 'type': 'object-detection'}, 'dataset': {'name': 'nls_chapbook_illustrations', 'type': 'nls_chapbook_illustrations', 'args': 'illustration_detection'}}
To https://huggingface.co/davanstrien/detr-resnet-50_fine_tuned_nls_chapbooks
   5c7b9d8..2ece586  main -&gt; main
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000">'https://huggingface.co/davanstrien/detr-resnet-50_fine_tuned_nls_chapbooks/commit/5c7b9d8907981c7ee0005334a3d96d5a8d623957'</span>
</pre>
</div>
<div class="cell-output cell-output-display">

</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We’ve seen how we can use the datasets library to perform object detection. The main thing we need to work out when we’re trying to use datasets for a computer vision task in the transfortmer libraryy is how to ensure we can create a transform that gets the images and annotations into a format understood by the relevant <code>feature_extractor</code>. Once we’ve done this for one example we need to replicate the same thing with a batch of examples so we can use it as a transform.</p>
<p>One this is in place many of the same approaches to defining the model and training arguments should look very familiar. I didn’t spend much time on the training process in this post. I’ll dig into tha in a fguure post as well as covering the process of using/evaluating the model.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/danielvanstrien\.xyz");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>